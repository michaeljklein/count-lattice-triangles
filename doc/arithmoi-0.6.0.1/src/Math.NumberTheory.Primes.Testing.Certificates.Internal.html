<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- |</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- Module:      Math.NumberTheory.Primes.Testing.Certificates.Internal</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Copyright:   (c) 2011 Daniel Fischer</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Licence:     MIT</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Maintainer:  Daniel Fischer &lt;daniel.is.fischer@googlemail.com&gt;</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- Stability:   Provisional</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Portability: Non-portable (GHC extensions)</span><span>
</span><a name="line-8"></a><span class="hs-comment">--</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Certificates for primality or compositeness.</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# OPTIONS_HADDOCK hide #-}</span><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">NumberTheory</span><span class="hs-operator">.</span><span class="hs-identifier">Primes</span><span class="hs-operator">.</span><span class="hs-identifier">Testing</span><span class="hs-operator">.</span><span class="hs-identifier">Certificates</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span>
</span><a name="line-13"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessProof"><span class="hs-identifier hs-type">CompositenessProof</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessArgument"><span class="hs-identifier hs-type">CompositenessArgument</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityArgument"><span class="hs-identifier hs-type">PrimalityArgument</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkCertificate"><span class="hs-identifier hs-var">checkCertificate</span></a><span>
</span><a name="line-19"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkCompositenessProof"><span class="hs-identifier hs-var">checkCompositenessProof</span></a><span>
</span><a name="line-20"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkPrimalityProof"><span class="hs-identifier hs-var">checkPrimalityProof</span></a><span>
</span><a name="line-21"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#certify"><span class="hs-identifier hs-var">certify</span></a><span>
</span><a name="line-22"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#trivial"><span class="hs-identifier hs-var">trivial</span></a><span>
</span><a name="line-23"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#smallCert"><span class="hs-identifier hs-var">smallCert</span></a><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#certifyBPSW"><span class="hs-identifier hs-var">certifyBPSW</span></a><span>
</span><a name="line-25"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#argueCertificate"><span class="hs-identifier hs-var">argueCertificate</span></a><span>
</span><a name="line-26"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#arguePrimality"><span class="hs-identifier hs-var">arguePrimality</span></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#argueCompositeness"><span class="hs-identifier hs-var">argueCompositeness</span></a><span>
</span><a name="line-28"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#verifyPrimalityArgument"><span class="hs-identifier hs-var">verifyPrimalityArgument</span></a><span>
</span><a name="line-29"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#verifyCompositenessArgument"><span class="hs-identifier hs-var">verifyCompositenessArgument</span></a><span>
</span><a name="line-30"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>
</span><a name="line-33"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 709</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span>
</span><a name="line-35"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">Integer</span><span class="hs-operator">.</span><span class="hs-identifier">GMP</span><span class="hs-operator">.</span><span class="hs-identifier">Internals</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Math.NumberTheory.Moduli.Class.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">NumberTheory</span><span class="hs-operator">.</span><span class="hs-identifier">Moduli</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="Math.NumberTheory.Utils.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">NumberTheory</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="Math.NumberTheory.Primes.Factorisation.TrialDivision.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">NumberTheory</span><span class="hs-operator">.</span><span class="hs-identifier">Primes</span><span class="hs-operator">.</span><span class="hs-identifier">Factorisation</span><span class="hs-operator">.</span><span class="hs-identifier">TrialDivision</span></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><a href="Math.NumberTheory.Primes.Factorisation.Montgomery.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">NumberTheory</span><span class="hs-operator">.</span><span class="hs-identifier">Primes</span><span class="hs-operator">.</span><span class="hs-identifier">Factorisation</span><span class="hs-operator">.</span><span class="hs-identifier">Montgomery</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Probabilistic.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">NumberTheory</span><span class="hs-operator">.</span><span class="hs-identifier">Primes</span><span class="hs-operator">.</span><span class="hs-identifier">Testing</span><span class="hs-operator">.</span><span class="hs-identifier">Probabilistic</span></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="Math.NumberTheory.Primes.Sieve.Eratosthenes.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">NumberTheory</span><span class="hs-operator">.</span><span class="hs-identifier">Primes</span><span class="hs-operator">.</span><span class="hs-identifier">Sieve</span><span class="hs-operator">.</span><span class="hs-identifier">Eratosthenes</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="Math.NumberTheory.Powers.Squares.html"><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">NumberTheory</span><span class="hs-operator">.</span><span class="hs-identifier">Powers</span><span class="hs-operator">.</span><span class="hs-identifier">Squares</span></a><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | A certificate of either compositeness or primality of an</span><span>
</span><a name="line-49"></a><span class="hs-comment">--   'Integer'. Only numbers @&gt; 1@ can be certified, trying to</span><span>
</span><a name="line-50"></a><span class="hs-comment">--   create a certificate for other numbers raises an error.</span><span>
</span><a name="line-51"></a><span class="hs-keyword">data</span><span> </span><a name="Certificate"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Certificate"><span class="hs-identifier">Certificate</span></a></a><span>
</span><a name="line-52"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="Composite"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier">Composite</span></a></a><span> </span><span class="hs-glyph">!</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessProof"><span class="hs-identifier hs-type">CompositenessProof</span></a><span>
</span><a name="line-53"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Prime"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier">Prime</span></a></a><span> </span><span class="hs-glyph">!</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span>
</span><a name="line-54"></a><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- | A proof of compositeness of a positive number. The type is</span><span>
</span><a name="line-57"></a><span class="hs-comment">--   abstract to ensure the validity of proofs.</span><span>
</span><a name="line-58"></a><span class="hs-keyword">data</span><span> </span><a name="CompositenessProof"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessProof"><span class="hs-identifier">CompositenessProof</span></a></a><span>
</span><a name="line-59"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="Factors"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Factors"><span class="hs-identifier">Factors</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="composite"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#composite"><span class="hs-identifier">composite</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span>           </span><span class="hs-comment">-- ^ The number whose compositeness is proved.</span><span>
</span><a name="line-60"></a><span>              </span><span class="hs-special">,</span><span> </span><a name="firstFactor"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#firstFactor"><span class="hs-identifier">firstFactor</span></a></a><span>
</span><a name="line-61"></a><span>              </span><span class="hs-special">,</span><span> </span><a name="secondFactor"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#secondFactor"><span class="hs-identifier">secondFactor</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="StrongFermat"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#StrongFermat"><span class="hs-identifier">StrongFermat</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="composite"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#composite"><span class="hs-identifier">composite</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span>      </span><span class="hs-comment">-- ^ The number whose compositeness is proved.</span><span>
</span><a name="line-63"></a><span>                   </span><span class="hs-special">,</span><span> </span><a name="witness"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#witness"><span class="hs-identifier">witness</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-64"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="LucasSelfridge"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#LucasSelfridge"><span class="hs-identifier">LucasSelfridge</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="composite"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#composite"><span class="hs-identifier">composite</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span>    </span><span class="hs-comment">-- ^ The number whose compositeness is proved.</span><span>
</span><a name="line-65"></a><span>                     </span><span class="hs-special">}</span><span>
</span><a name="line-66"></a><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | An argument for compositeness of a number (which must be @&gt; 1@).</span><span>
</span><a name="line-69"></a><span class="hs-comment">--   'CompositenessProof's translate directly to 'CompositenessArguments',</span><span>
</span><a name="line-70"></a><span class="hs-comment">--   correct arguments can be transformed into proofs. This type allows the</span><span>
</span><a name="line-71"></a><span class="hs-comment">--   manipulation of proofs while maintaining their correctness.</span><span>
</span><a name="line-72"></a><span class="hs-comment">--   The only way to access components of a 'CompositenessProof' except</span><span>
</span><a name="line-73"></a><span class="hs-comment">--   the composite is through this type.</span><span>
</span><a name="line-74"></a><span class="hs-keyword">data</span><span> </span><a name="CompositenessArgument"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessArgument"><span class="hs-identifier">CompositenessArgument</span></a></a><span>
</span><a name="line-75"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="Divisors"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Divisors"><span class="hs-identifier">Divisors</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="compo"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#compo"><span class="hs-identifier">compo</span></a></a><span class="hs-special">,</span><span> </span><a name="firstDivisor"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#firstDivisor"><span class="hs-identifier">firstDivisor</span></a></a><span class="hs-special">,</span><span> </span><a name="secondDivisor"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#secondDivisor"><span class="hs-identifier">secondDivisor</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-76"></a><span>                                                </span><span class="hs-comment">-- ^ @compo == firstDiv*secondDiv@, where all are @&gt; 1@</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Fermat"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Fermat"><span class="hs-identifier">Fermat</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="compo"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#compo"><span class="hs-identifier">compo</span></a></a><span class="hs-special">,</span><span> </span><a name="fermatBase"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#fermatBase"><span class="hs-identifier">fermatBase</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-special">}</span><span>   </span><span class="hs-comment">-- ^ @compo@ fails the strong Fermat test for @fermatBase@</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Lucas"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Lucas"><span class="hs-identifier">Lucas</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="compo"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#compo"><span class="hs-identifier">compo</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-special">}</span><span>                </span><span class="hs-comment">-- ^ @compo@ fails the Lucas-Selfridge test</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Belief"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Belief"><span class="hs-identifier">Belief</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="compo"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#compo"><span class="hs-identifier">compo</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-special">}</span><span>               </span><span class="hs-comment">-- ^ No particular reason given</span><span>
</span><a name="line-80"></a><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Read</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">-- | A proof of primality of a positive number. The type is</span><span>
</span><a name="line-83"></a><span class="hs-comment">--   abstract to ensure the validity of proofs.</span><span>
</span><a name="line-84"></a><span class="hs-keyword">data</span><span> </span><a name="PrimalityProof"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier">PrimalityProof</span></a></a><span>
</span><a name="line-85"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="Pocklington"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Pocklington"><span class="hs-identifier">Pocklington</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="cprime"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#cprime"><span class="hs-identifier">cprime</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span>          </span><span class="hs-comment">-- ^ The number whose primality is proved.</span><span>
</span><a name="line-86"></a><span>                  </span><span class="hs-special">,</span><span> </span><a name="factorisedPart"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#factorisedPart"><span class="hs-identifier">factorisedPart</span></a></a><span class="hs-special">,</span><span> </span><a name="cofactor"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#cofactor"><span class="hs-identifier">cofactor</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-87"></a><span>                  </span><span class="hs-special">,</span><span> </span><a name="knownFactors"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#knownFactors"><span class="hs-identifier">knownFactors</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-88"></a><span>                  </span><span class="hs-special">}</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="TrialDivision"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#TrialDivision"><span class="hs-identifier">TrialDivision</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="cprime"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#cprime"><span class="hs-identifier">cprime</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span>        </span><span class="hs-comment">-- ^ The number whose primality is proved.</span><span>
</span><a name="line-90"></a><span>                    </span><span class="hs-special">,</span><span> </span><a name="tdLimit"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#tdLimit"><span class="hs-identifier">tdLimit</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Trivial"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Trivial"><span class="hs-identifier">Trivial</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="cprime"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#cprime"><span class="hs-identifier">cprime</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Integer</span><span>              </span><span class="hs-comment">-- ^ The number whose primality is proved.</span><span>
</span><a name="line-92"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-93"></a><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | An argument for primality of a number (which must be @&gt; 1@).</span><span>
</span><a name="line-96"></a><span class="hs-comment">--   'PrimalityProof's translate directly to 'PrimalityArguments',</span><span>
</span><a name="line-97"></a><span class="hs-comment">--   correct arguments can be transformed into proofs. This type allows the</span><span>
</span><a name="line-98"></a><span class="hs-comment">--   manipulation of proofs while maintaining their correctness.</span><span>
</span><a name="line-99"></a><span class="hs-comment">--   The only way to access components of a 'PrimalityProof' except</span><span>
</span><a name="line-100"></a><span class="hs-comment">--   the prime is through this type.</span><span>
</span><a name="line-101"></a><span class="hs-keyword">data</span><span> </span><a name="PrimalityArgument"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityArgument"><span class="hs-identifier">PrimalityArgument</span></a></a><span>
</span><a name="line-102"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="Pock"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Pock"><span class="hs-identifier">Pock</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="aprime"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#aprime"><span class="hs-identifier">aprime</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-103"></a><span>           </span><span class="hs-special">,</span><span> </span><a name="largeFactor"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#largeFactor"><span class="hs-identifier">largeFactor</span></a></a><span class="hs-special">,</span><span> </span><a name="smallFactor"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#smallFactor"><span class="hs-identifier">smallFactor</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-104"></a><span>           </span><span class="hs-special">,</span><span> </span><a name="factorList"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#factorList"><span class="hs-identifier">factorList</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityArgument"><span class="hs-identifier hs-type">PrimalityArgument</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-105"></a><span>           </span><span class="hs-special">}</span><span>                                 </span><span class="hs-comment">-- ^ A suggested Pocklington certificate</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Division"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Division"><span class="hs-identifier">Division</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="aprime"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#aprime"><span class="hs-identifier">aprime</span></a></a><span class="hs-special">,</span><span> </span><a name="alimit"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#alimit"><span class="hs-identifier">alimit</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- ^ Primality should be provable by trial division to @alimit@</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Obvious"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Obvious"><span class="hs-identifier">Obvious</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="aprime"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#aprime"><span class="hs-identifier">aprime</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-special">}</span><span>          </span><span class="hs-comment">-- ^ @aprime@ is said to be obviously prime, that holds for primes @&lt; 30@</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Assumption"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Assumption"><span class="hs-identifier">Assumption</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="aprime"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#aprime"><span class="hs-identifier">aprime</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-special">}</span><span>       </span><span class="hs-comment">-- ^ Primality assumed</span><span>
</span><a name="line-109"></a><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Read</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-identifier">argueCertificate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessArgument"><span class="hs-identifier hs-type">CompositenessArgument</span></a><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityArgument"><span class="hs-identifier hs-type">PrimalityArgument</span></a><span>
</span><a name="line-112"></a><a name="argueCertificate"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#argueCertificate"><span class="hs-identifier">argueCertificate</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><a name="local-6989586621679076224"><a href="#local-6989586621679076224"><span class="hs-identifier">proof</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#argueCompositeness"><span class="hs-identifier hs-var">argueCompositeness</span></a><span> </span><a href="#local-6989586621679076224"><span class="hs-identifier hs-var">proof</span></a><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span class="hs-identifier">argueCertificate</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier hs-var">Prime</span></a><span> </span><a name="local-6989586621679076225"><a href="#local-6989586621679076225"><span class="hs-identifier">proof</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#arguePrimality"><span class="hs-identifier hs-var">arguePrimality</span></a><span> </span><a href="#local-6989586621679076225"><span class="hs-identifier hs-var">proof</span></a><span class="hs-special">)</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">-- | @'arguePrimality'@ transforms a proof of primality into an argument for primality.</span><span>
</span><a name="line-116"></a><span class="hs-identifier">arguePrimality</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityArgument"><span class="hs-identifier hs-type">PrimalityArgument</span></a><span>
</span><a name="line-117"></a><a name="arguePrimality"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#arguePrimality"><span class="hs-identifier">arguePrimality</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#TrialDivision"><span class="hs-identifier hs-var">TrialDivision</span></a><span> </span><a name="local-6989586621679076226"><a href="#local-6989586621679076226"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679076227"><a href="#local-6989586621679076227"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Division"><span class="hs-identifier hs-var">Division</span></a><span> </span><a href="#local-6989586621679076226"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679076227"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-118"></a><span class="hs-identifier">arguePrimality</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Trivial"><span class="hs-identifier hs-var">Trivial</span></a><span> </span><a name="local-6989586621679076228"><a href="#local-6989586621679076228"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Obvious"><span class="hs-identifier hs-var">Obvious</span></a><span> </span><a href="#local-6989586621679076228"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-119"></a><span class="hs-identifier">arguePrimality</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Pocklington"><span class="hs-identifier hs-var">Pocklington</span></a><span> </span><a name="local-6989586621679076229"><a href="#local-6989586621679076229"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679076230"><a href="#local-6989586621679076230"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679076231"><a href="#local-6989586621679076231"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679076232"><a href="#local-6989586621679076232"><span class="hs-identifier">fcts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Pock"><span class="hs-identifier hs-var">Pock</span></a><span> </span><a href="#local-6989586621679076229"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679076230"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679076231"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679076233"><span class="hs-identifier hs-var">argue</span></a><span> </span><a href="#local-6989586621679076232"><span class="hs-identifier hs-var">fcts</span></a><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-121"></a><span>    </span><a name="local-6989586621679076233"><a href="#local-6989586621679076233"><span class="hs-identifier">argue</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679076234"><a href="#local-6989586621679076234"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076235"><a href="#local-6989586621679076235"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076236"><a href="#local-6989586621679076236"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076237"><a href="#local-6989586621679076237"><span class="hs-identifier">prf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076234"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679076235"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><a href="#local-6989586621679076236"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#arguePrimality"><span class="hs-identifier hs-var">arguePrimality</span></a><span> </span><a href="#local-6989586621679076237"><span class="hs-identifier hs-var">prf</span></a><span class="hs-special">)</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">-- | @'verifyPrimalityArgument'@ checks the given argument and constructs a proof from</span><span>
</span><a name="line-124"></a><span class="hs-comment">--   it, if it is valid. For the explicit arguments, this is simple and resonably fast,</span><span>
</span><a name="line-125"></a><span class="hs-comment">--   for an 'Assumption', the verification uses 'certify' and hence may take a long time.</span><span>
</span><a name="line-126"></a><span class="hs-identifier">verifyPrimalityArgument</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityArgument"><span class="hs-identifier hs-type">PrimalityArgument</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span>
</span><a name="line-127"></a><a name="verifyPrimalityArgument"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#verifyPrimalityArgument"><span class="hs-identifier">verifyPrimalityArgument</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Assumption"><span class="hs-identifier hs-var">Assumption</span></a><span> </span><a name="local-6989586621679076238"><a href="#local-6989586621679076238"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#certify"><span class="hs-identifier hs-var">certify</span></a><span> </span><a href="#local-6989586621679076238"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-129"></a><span>        </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-130"></a><span>        </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier hs-var">Prime</span></a><span> </span><a name="local-6989586621679076239"><a href="#local-6989586621679076239"><span class="hs-identifier">proof</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679076239"><span class="hs-identifier hs-var">proof</span></a><span>
</span><a name="line-131"></a><span class="hs-identifier">verifyPrimalityArgument</span><span> </span><a name="local-6989586621679076240"><a href="#local-6989586621679076240"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-132"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkPrimalityProof"><span class="hs-identifier hs-var">checkPrimalityProof</span></a><span> </span><a href="#local-6989586621679076241"><span class="hs-identifier hs-var">prf</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679076241"><span class="hs-identifier hs-var">prf</span></a><span>
</span><a name="line-133"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-134"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-135"></a><span>        </span><a name="local-6989586621679076241"><a href="#local-6989586621679076241"><span class="hs-identifier">prf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#primProof"><span class="hs-identifier hs-var">primProof</span></a><span> </span><a href="#local-6989586621679076240"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">-- | not exported, this is the one place where invalid proofs can be constructed</span><span>
</span><a name="line-138"></a><span class="hs-identifier">primProof</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityArgument"><span class="hs-identifier hs-type">PrimalityArgument</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span>
</span><a name="line-139"></a><a name="primProof"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#primProof"><span class="hs-identifier">primProof</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Division"><span class="hs-identifier hs-var">Division</span></a><span> </span><a name="local-6989586621679076242"><a href="#local-6989586621679076242"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679076243"><a href="#local-6989586621679076243"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#TrialDivision"><span class="hs-identifier hs-var">TrialDivision</span></a><span> </span><a href="#local-6989586621679076242"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679076243"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-140"></a><span class="hs-identifier">primProof</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Obvious"><span class="hs-identifier hs-var">Obvious</span></a><span> </span><a name="local-6989586621679076244"><a href="#local-6989586621679076244"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Trivial"><span class="hs-identifier hs-var">Trivial</span></a><span> </span><a href="#local-6989586621679076244"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-141"></a><span class="hs-identifier">primProof</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Assumption"><span class="hs-identifier hs-var">Assumption</span></a><span> </span><a name="local-6989586621679076245"><a href="#local-6989586621679076245"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#certify"><span class="hs-identifier hs-var">certify</span></a><span> </span><a href="#local-6989586621679076245"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-142"></a><span>                             </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Trivial"><span class="hs-identifier hs-var">Trivial</span></a><span> </span><a href="#local-6989586621679076245"><span class="hs-identifier hs-var">p</span></a><span>   </span><span class="hs-comment">-- we're faking to not raise an error</span><span>
</span><a name="line-143"></a><span>                             </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier hs-var">Prime</span></a><span> </span><a name="local-6989586621679076246"><a href="#local-6989586621679076246"><span class="hs-identifier">proof</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679076246"><span class="hs-identifier hs-var">proof</span></a><span>
</span><a name="line-144"></a><span class="hs-identifier">primProof</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Pock"><span class="hs-identifier hs-var">Pock</span></a><span> </span><a name="local-6989586621679076247"><a href="#local-6989586621679076247"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679076248"><a href="#local-6989586621679076248"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679076249"><a href="#local-6989586621679076249"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679076250"><a href="#local-6989586621679076250"><span class="hs-identifier">fcts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Pocklington"><span class="hs-identifier hs-var">Pocklington</span></a><span> </span><a href="#local-6989586621679076247"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679076248"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679076249"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679076251"><span class="hs-identifier hs-var">prove</span></a><span> </span><a href="#local-6989586621679076250"><span class="hs-identifier hs-var">fcts</span></a><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-146"></a><span>    </span><a name="local-6989586621679076251"><a href="#local-6989586621679076251"><span class="hs-identifier">prove</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679076252"><a href="#local-6989586621679076252"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076253"><a href="#local-6989586621679076253"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076254"><a href="#local-6989586621679076254"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076255"><a href="#local-6989586621679076255"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076252"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679076253"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><a href="#local-6989586621679076254"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#primProof"><span class="hs-identifier hs-var">primProof</span></a><span> </span><a href="#local-6989586621679076255"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-comment">-- | @'argueCompositeness'@ transforms a proof of compositeness into an argument</span><span>
</span><a name="line-149"></a><span class="hs-comment">--   for compositeness.</span><span>
</span><a name="line-150"></a><span class="hs-identifier">argueCompositeness</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessProof"><span class="hs-identifier hs-type">CompositenessProof</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessArgument"><span class="hs-identifier hs-type">CompositenessArgument</span></a><span>
</span><a name="line-151"></a><a name="argueCompositeness"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#argueCompositeness"><span class="hs-identifier">argueCompositeness</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Factors"><span class="hs-identifier hs-var">Factors</span></a><span> </span><a name="local-6989586621679076256"><a href="#local-6989586621679076256"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679076257"><a href="#local-6989586621679076257"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679076258"><a href="#local-6989586621679076258"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Divisors"><span class="hs-identifier hs-var">Divisors</span></a><span> </span><a href="#local-6989586621679076256"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679076257"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679076258"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-152"></a><span class="hs-identifier">argueCompositeness</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#StrongFermat"><span class="hs-identifier hs-var">StrongFermat</span></a><span> </span><a name="local-6989586621679076259"><a href="#local-6989586621679076259"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679076260"><a href="#local-6989586621679076260"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Fermat"><span class="hs-identifier hs-var">Fermat</span></a><span> </span><a href="#local-6989586621679076259"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679076260"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-153"></a><span class="hs-identifier">argueCompositeness</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#LucasSelfridge"><span class="hs-identifier hs-var">LucasSelfridge</span></a><span> </span><a name="local-6989586621679076261"><a href="#local-6989586621679076261"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Lucas"><span class="hs-identifier hs-var">Lucas</span></a><span> </span><a href="#local-6989586621679076261"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-comment">-- | @'verifyCompositenessArgument'@ checks the given argument and constructs a proof from</span><span>
</span><a name="line-156"></a><span class="hs-comment">--   it, if it is valid. For the explicit arguments, this is simple and resonably fast,</span><span>
</span><a name="line-157"></a><span class="hs-comment">--   for a 'Belief', the verification uses 'certify' and hence may take a long time.</span><span>
</span><a name="line-158"></a><span class="hs-identifier">verifyCompositenessArgument</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessArgument"><span class="hs-identifier hs-type">CompositenessArgument</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessProof"><span class="hs-identifier hs-type">CompositenessProof</span></a><span>
</span><a name="line-159"></a><a name="verifyCompositenessArgument"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#verifyCompositenessArgument"><span class="hs-identifier">verifyCompositenessArgument</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Belief"><span class="hs-identifier hs-var">Belief</span></a><span> </span><a name="local-6989586621679076262"><a href="#local-6989586621679076262"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#certify"><span class="hs-identifier hs-var">certify</span></a><span> </span><a href="#local-6989586621679076262"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-161"></a><span>        </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><a name="local-6989586621679076263"><a href="#local-6989586621679076263"><span class="hs-identifier">proof</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679076263"><span class="hs-identifier hs-var">proof</span></a><span>
</span><a name="line-162"></a><span>        </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier hs-var">Prime</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-163"></a><span class="hs-identifier">verifyCompositenessArgument</span><span> </span><a name="local-6989586621679076264"><a href="#local-6989586621679076264"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-164"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkCompositenessProof"><span class="hs-identifier hs-var">checkCompositenessProof</span></a><span> </span><a href="#local-6989586621679076265"><span class="hs-identifier hs-var">prf</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679076265"><span class="hs-identifier hs-var">prf</span></a><span>
</span><a name="line-165"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-166"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-167"></a><span>        </span><a name="local-6989586621679076265"><a href="#local-6989586621679076265"><span class="hs-identifier">prf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#compProof"><span class="hs-identifier hs-var">compProof</span></a><span> </span><a href="#local-6989586621679076264"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span class="hs-comment">-- | not exported, here is where invalid proofs can be constructed,</span><span>
</span><a name="line-170"></a><span class="hs-comment">--   they must not leak</span><span>
</span><a name="line-171"></a><span class="hs-identifier">compProof</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessArgument"><span class="hs-identifier hs-type">CompositenessArgument</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessProof"><span class="hs-identifier hs-type">CompositenessProof</span></a><span>
</span><a name="line-172"></a><a name="compProof"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#compProof"><span class="hs-identifier">compProof</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Divisors"><span class="hs-identifier hs-var">Divisors</span></a><span> </span><a name="local-6989586621679076266"><a href="#local-6989586621679076266"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679076267"><a href="#local-6989586621679076267"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679076268"><a href="#local-6989586621679076268"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Factors"><span class="hs-identifier hs-var">Factors</span></a><span> </span><a href="#local-6989586621679076266"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679076267"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679076268"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-173"></a><span class="hs-identifier">compProof</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Fermat"><span class="hs-identifier hs-var">Fermat</span></a><span> </span><a name="local-6989586621679076269"><a href="#local-6989586621679076269"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679076270"><a href="#local-6989586621679076270"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#StrongFermat"><span class="hs-identifier hs-var">StrongFermat</span></a><span> </span><a href="#local-6989586621679076269"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679076270"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-174"></a><span class="hs-identifier">compProof</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Lucas"><span class="hs-identifier hs-var">Lucas</span></a><span> </span><a name="local-6989586621679076271"><a href="#local-6989586621679076271"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#LucasSelfridge"><span class="hs-identifier hs-var">LucasSelfridge</span></a><span> </span><a href="#local-6989586621679076271"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-175"></a><span class="hs-identifier">compProof</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Belief"><span class="hs-identifier hs-var">Belief</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Trying to prove by belief&quot;</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-comment">-- | Check the validity of a 'Certificate'. Since it should be impossible</span><span>
</span><a name="line-178"></a><span class="hs-comment">--   to construct invalid certificates by the public interface, this should</span><span>
</span><a name="line-179"></a><span class="hs-comment">--   never return 'False'.</span><span>
</span><a name="line-180"></a><span class="hs-identifier">checkCertificate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-181"></a><a name="checkCertificate"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkCertificate"><span class="hs-identifier">checkCertificate</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><a name="local-6989586621679076272"><a href="#local-6989586621679076272"><span class="hs-identifier">cp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkCompositenessProof"><span class="hs-identifier hs-var">checkCompositenessProof</span></a><span> </span><a href="#local-6989586621679076272"><span class="hs-identifier hs-var">cp</span></a><span>
</span><a name="line-182"></a><span class="hs-identifier">checkCertificate</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier hs-var">Prime</span></a><span> </span><a name="local-6989586621679076273"><a href="#local-6989586621679076273"><span class="hs-identifier">pp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkPrimalityProof"><span class="hs-identifier hs-var">checkPrimalityProof</span></a><span> </span><a href="#local-6989586621679076273"><span class="hs-identifier hs-var">pp</span></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-comment">-- | Check the validity of a 'CompositenessProof'. Since it should be</span><span>
</span><a name="line-185"></a><span class="hs-comment">--   impossible to create invalid proofs by the public interface, this</span><span>
</span><a name="line-186"></a><span class="hs-comment">--   should never return 'False'.</span><span>
</span><a name="line-187"></a><span class="hs-identifier">checkCompositenessProof</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#CompositenessProof"><span class="hs-identifier hs-type">CompositenessProof</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-188"></a><a name="checkCompositenessProof"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkCompositenessProof"><span class="hs-identifier">checkCompositenessProof</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Factors"><span class="hs-identifier hs-var">Factors</span></a><span> </span><a name="local-6989586621679076274"><a href="#local-6989586621679076274"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679076275"><a href="#local-6989586621679076275"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679076276"><a href="#local-6989586621679076276"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076275"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679076276"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679076275"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679076276"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679076274"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-189"></a><span class="hs-identifier">checkCompositenessProof</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#StrongFermat"><span class="hs-identifier hs-var">StrongFermat</span></a><span> </span><a name="local-6989586621679076277"><a href="#local-6989586621679076277"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679076278"><a href="#local-6989586621679076278"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076278"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679076277"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679076278"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Probabilistic.html#isStrongFermatPP"><span class="hs-identifier hs-var">isStrongFermatPP</span></a><span> </span><a href="#local-6989586621679076277"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679076278"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span class="hs-identifier">checkCompositenessProof</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#LucasSelfridge"><span class="hs-identifier hs-var">LucasSelfridge</span></a><span> </span><a name="local-6989586621679076279"><a href="#local-6989586621679076279"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076279"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679076279"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Probabilistic.html#lucasTest"><span class="hs-identifier hs-var">lucasTest</span></a><span> </span><a href="#local-6989586621679076279"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- | Check the validity of a 'PrimalityProof'. Since it should be</span><span>
</span><a name="line-193"></a><span class="hs-comment">--   impossible to create invalid proofs by the public interface, this</span><span>
</span><a name="line-194"></a><span class="hs-comment">--   should never return 'False'.</span><span>
</span><a name="line-195"></a><span class="hs-identifier">checkPrimalityProof</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-196"></a><a name="checkPrimalityProof"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkPrimalityProof"><span class="hs-identifier">checkPrimalityProof</span></a></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Trivial"><span class="hs-identifier hs-var">Trivial</span></a><span> </span><a name="local-6989586621679076280"><a href="#local-6989586621679076280"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#isTrivialPrime"><span class="hs-identifier hs-var">isTrivialPrime</span></a><span> </span><a href="#local-6989586621679076280"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-197"></a><span class="hs-identifier">checkPrimalityProof</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#TrialDivision"><span class="hs-identifier hs-var">TrialDivision</span></a><span> </span><a name="local-6989586621679076281"><a href="#local-6989586621679076281"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679076282"><a href="#local-6989586621679076282"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076281"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679076282"><span class="hs-identifier hs-var">b</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679076282"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Math.NumberTheory.Primes.Factorisation.TrialDivision.html#trialDivisionPrimeTo"><span class="hs-identifier hs-var">trialDivisionPrimeTo</span></a><span> </span><a href="#local-6989586621679076282"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679076281"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-198"></a><span class="hs-identifier">checkPrimalityProof</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Pocklington"><span class="hs-identifier hs-var">Pocklington</span></a><span> </span><a name="local-6989586621679076283"><a href="#local-6989586621679076283"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679076284"><a href="#local-6989586621679076284"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679076285"><a href="#local-6989586621679076285"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679076286"><a href="#local-6989586621679076286"><span class="hs-identifier">fcts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076285"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679076284"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679076285"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679076284"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679076285"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679076287"><span class="hs-identifier hs-var">pm1</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679076284"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679076288"><span class="hs-identifier hs-var">ppProd</span></a><span> </span><a href="#local-6989586621679076286"><span class="hs-identifier hs-var">fcts</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="#local-6989586621679076289"><span class="hs-identifier hs-var">verify</span></a><span> </span><a href="#local-6989586621679076286"><span class="hs-identifier hs-var">fcts</span></a><span>
</span><a name="line-199"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-200"></a><span>    </span><a name="local-6989586621679076287"><a href="#local-6989586621679076287"><span class="hs-identifier">pm1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076283"><span class="hs-identifier hs-var">p</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span>
</span><a name="line-201"></a><span>    </span><a name="local-6989586621679076288"><a href="#local-6989586621679076288"><span class="hs-identifier">ppProd</span></a></a><span> </span><a name="local-6989586621679076291"><a href="#local-6989586621679076291"><span class="hs-identifier">pps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">product</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679076292"><span class="hs-identifier hs-var">pf</span></a><span class="hs-operator hs-var">^</span><a href="#local-6989586621679076293"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679076292"><a href="#local-6989586621679076292"><span class="hs-identifier">pf</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076293"><a href="#local-6989586621679076293"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679076291"><span class="hs-identifier hs-var">pps</span></a><span class="hs-special">]</span><span>
</span><a name="line-202"></a><span>    </span><a name="local-6989586621679076289"><a href="#local-6989586621679076289"><span class="hs-identifier">verify</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679076294"><a href="#local-6989586621679076294"><span class="hs-identifier">pf</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679076295"><a href="#local-6989586621679076295"><span class="hs-identifier">base</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076296"><a href="#local-6989586621679076296"><span class="hs-identifier">proof</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076294"><span class="hs-identifier hs-var">pf</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">cprime</span><span> </span><a href="#local-6989586621679076296"><span class="hs-identifier hs-var">proof</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679076290"><span class="hs-identifier hs-var">crit</span></a><span> </span><a href="#local-6989586621679076294"><span class="hs-identifier hs-var">pf</span></a><span> </span><a href="#local-6989586621679076295"><span class="hs-identifier hs-var">base</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#checkPrimalityProof"><span class="hs-identifier hs-var">checkPrimalityProof</span></a><span> </span><a href="#local-6989586621679076296"><span class="hs-identifier hs-var">proof</span></a><span>
</span><a name="line-203"></a><span>    </span><a name="local-6989586621679076290"><a href="#local-6989586621679076290"><span class="hs-identifier">crit</span></a></a><span> </span><a name="local-6989586621679076297"><a href="#local-6989586621679076297"><span class="hs-identifier">pf</span></a></a><span> </span><a name="local-6989586621679076298"><a href="#local-6989586621679076298"><span class="hs-identifier">base</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">gcd</span><span> </span><a href="#local-6989586621679076283"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076299"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679076300"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-204"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-205"></a><span>        </span><a name="local-6989586621679076299"><a href="#local-6989586621679076299"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">powModInteger</span><span> </span><a href="#local-6989586621679076298"><span class="hs-identifier hs-var">base</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076287"><span class="hs-identifier hs-var">pm1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679076297"><span class="hs-identifier hs-var">pf</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679076283"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-206"></a><span>        </span><a name="local-6989586621679076300"><a href="#local-6989586621679076300"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">powModInteger</span><span> </span><a href="#local-6989586621679076299"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679076297"><span class="hs-identifier hs-var">pf</span></a><span> </span><a href="#local-6989586621679076283"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-comment">-- | @'trivial'@ records a trivially known prime.</span><span>
</span><a name="line-209"></a><span class="hs-comment">--   If the argument is not one of them, an error is raised.</span><span>
</span><a name="line-210"></a><span class="hs-identifier">trivial</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span>
</span><a name="line-211"></a><a name="trivial"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#trivial"><span class="hs-identifier">trivial</span></a></a><span> </span><a name="local-6989586621679076301"><a href="#local-6989586621679076301"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><a href="#local-6989586621679076302"><span class="hs-identifier hs-var">oops</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#maybeTrivial"><span class="hs-identifier hs-var">maybeTrivial</span></a><span> </span><a href="#local-6989586621679076301"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-212"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-213"></a><span>    </span><a name="local-6989586621679076302"><a href="#local-6989586621679076302"><span class="hs-identifier">oops</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;trivial: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679076301"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; isn't a trivially known prime.&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-comment">-- | @'maybeTrivial'@ finds out if its argument is a trivially known</span><span>
</span><a name="line-216"></a><span class="hs-comment">--   prime or not and returns the appropriate.</span><span>
</span><a name="line-217"></a><span class="hs-identifier">maybeTrivial</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span>
</span><a name="line-218"></a><a name="maybeTrivial"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#maybeTrivial"><span class="hs-identifier">maybeTrivial</span></a></a><span> </span><a name="local-6989586621679076303"><a href="#local-6989586621679076303"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-219"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#isTrivialPrime"><span class="hs-identifier hs-var">isTrivialPrime</span></a><span> </span><a href="#local-6989586621679076303"><span class="hs-identifier hs-var">n</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Trivial"><span class="hs-identifier hs-var">Trivial</span></a><span> </span><a href="#local-6989586621679076303"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-220"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-comment">-- | @'isTrivialPrime'@ checks whether its argument is a trivially</span><span>
</span><a name="line-223"></a><span class="hs-comment">--   known prime.</span><span>
</span><a name="line-224"></a><span class="hs-identifier">isTrivialPrime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-225"></a><a name="isTrivialPrime"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#isTrivialPrime"><span class="hs-identifier">isTrivialPrime</span></a></a><span> </span><a name="local-6989586621679076304"><a href="#local-6989586621679076304"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076304"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#trivialPrimes"><span class="hs-identifier hs-var">trivialPrimes</span></a><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-comment">-- | List of trivially known primes.</span><span>
</span><a name="line-228"></a><span class="hs-identifier">trivialPrimes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">]</span><span>
</span><a name="line-229"></a><a name="trivialPrimes"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#trivialPrimes"><span class="hs-identifier">trivialPrimes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">5</span><span class="hs-special">,</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">11</span><span class="hs-special">,</span><span class="hs-number">13</span><span class="hs-special">,</span><span class="hs-number">17</span><span class="hs-special">,</span><span class="hs-number">19</span><span class="hs-special">,</span><span class="hs-number">23</span><span class="hs-special">,</span><span class="hs-number">29</span><span class="hs-special">]</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">-- | Certify a small number. This is not exposed and should only</span><span>
</span><a name="line-232"></a><span class="hs-comment">--   be used where correct. It is always checked after use, though,</span><span>
</span><a name="line-233"></a><span class="hs-comment">--   so it shouldn't be able to lie.</span><span>
</span><a name="line-234"></a><span class="hs-identifier">smallCert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span>
</span><a name="line-235"></a><a name="smallCert"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#smallCert"><span class="hs-identifier">smallCert</span></a></a><span> </span><a name="local-6989586621679076305"><a href="#local-6989586621679076305"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-236"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076305"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">30</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Trivial"><span class="hs-identifier hs-var">Trivial</span></a><span> </span><a href="#local-6989586621679076305"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-237"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#TrialDivision"><span class="hs-identifier hs-var">TrialDivision</span></a><span> </span><a href="#local-6989586621679076305"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Powers.Squares.html#integerSquareRoot%27"><span class="hs-identifier hs-var">integerSquareRoot'</span></a><span> </span><a href="#local-6989586621679076305"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-comment">-- | @'certify' n@ constructs, for @n &gt; 1@, a proof of either</span><span>
</span><a name="line-240"></a><span class="hs-comment">--   primality or compositeness of @n@. This may take a very long</span><span>
</span><a name="line-241"></a><span class="hs-comment">--   time if the number has no small(ish) prime divisors</span><span>
</span><a name="line-242"></a><span class="hs-identifier">certify</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Certificate"><span class="hs-identifier hs-type">Certificate</span></a><span>
</span><a name="line-243"></a><a name="certify"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#certify"><span class="hs-identifier">certify</span></a></a><span> </span><a name="local-6989586621679076306"><a href="#local-6989586621679076306"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-244"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">2</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Only numbers larger than 1 can be certified&quot;</span><span>
</span><a name="line-245"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">31</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.NumberTheory.Primes.Factorisation.TrialDivision.html#trialDivisionWith"><span class="hs-identifier hs-var">trialDivisionWith</span></a><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#trivialPrimes"><span class="hs-identifier hs-var">trivialPrimes</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-246"></a><span>                    </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679076308"><a href="#local-6989586621679076308"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076308"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Factors"><span class="hs-identifier hs-var">Factors</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679076308"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679076308"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier hs-var">Prime</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Trivial"><span class="hs-identifier hs-var">Trivial</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-248"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Impossible&quot;</span><span>
</span><a name="line-249"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679076307"><span class="hs-identifier hs-var">billi</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679076309"><a href="#local-6989586621679076309"><span class="hs-identifier">r2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Powers.Squares.html#integerSquareRoot%27"><span class="hs-identifier hs-var">integerSquareRoot'</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-250"></a><span>                  </span><span class="hs-keyword">case</span><span> </span><a href="Math.NumberTheory.Primes.Factorisation.TrialDivision.html#trialDivisionTo"><span class="hs-identifier hs-var">trialDivisionTo</span></a><span> </span><a href="#local-6989586621679076309"><span class="hs-identifier hs-var">r2</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-251"></a><span>                    </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679076310"><a href="#local-6989586621679076310"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076310"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Factors"><span class="hs-identifier hs-var">Factors</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679076310"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679076310"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-252"></a><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier hs-var">Prime</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#TrialDivision"><span class="hs-identifier hs-var">TrialDivision</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679076309"><span class="hs-identifier hs-var">r2</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Impossible&quot;</span><span>
</span><a name="line-254"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.NumberTheory.Primes.Factorisation.Montgomery.html#smallFactors"><span class="hs-identifier hs-var">smallFactors</span></a><span> </span><span class="hs-number">100000</span><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-255"></a><span>                    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Probabilistic.html#isStrongFermatPP"><span class="hs-identifier hs-var">isStrongFermatPP</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#StrongFermat"><span class="hs-identifier hs-var">StrongFermat</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>                                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Probabilistic.html#lucasTest"><span class="hs-identifier hs-var">lucasTest</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#LucasSelfridge"><span class="hs-identifier hs-var">LucasSelfridge</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>                                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier hs-var">Prime</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#certifyBPSW"><span class="hs-identifier hs-var">certifyBPSW</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- if it isn't we error and ask for a report.</span><span>
</span><a name="line-258"></a><span>                    </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679076311"><a href="#local-6989586621679076311"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076311"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier hs-var">Prime</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#TrialDivision"><span class="hs-identifier hs-var">TrialDivision</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">min</span><span> </span><span class="hs-number">100000</span><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>                                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Factors"><span class="hs-identifier hs-var">Factors</span></a><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679076311"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679076311"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;***Error factorising &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679076306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;! Please report this to maintainer of arithmoi.&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-262"></a><span>        </span><a name="local-6989586621679076307"><a href="#local-6989586621679076307"><span class="hs-identifier">billi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1000000000000</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-comment">-- | Certify a number known to be not too small, having no small prime divisors and having</span><span>
</span><a name="line-265"></a><span class="hs-comment">--   passed the Baillie PSW test. So we assume it's prime, erroring if not.</span><span>
</span><a name="line-266"></a><span class="hs-comment">--   Since it's presumably a large number, we don't bother with trial division and</span><span>
</span><a name="line-267"></a><span class="hs-comment">--   construct a Pocklington certificate.</span><span>
</span><a name="line-268"></a><span class="hs-identifier">certifyBPSW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#PrimalityProof"><span class="hs-identifier hs-type">PrimalityProof</span></a><span>
</span><a name="line-269"></a><a name="certifyBPSW"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#certifyBPSW"><span class="hs-identifier">certifyBPSW</span></a></a><span> </span><a name="local-6989586621679076312"><a href="#local-6989586621679076312"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Pocklington"><span class="hs-identifier hs-var">Pocklington</span></a><span> </span><a href="#local-6989586621679076312"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679076316"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679076318"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679076320"><span class="hs-identifier hs-var">kfcts</span></a><span>
</span><a name="line-270"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-271"></a><span>    </span><a name="local-6989586621679076313"><a href="#local-6989586621679076313"><span class="hs-identifier">nm1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076312"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span>
</span><a name="line-272"></a><span>    </span><a name="local-6989586621679076314"><a href="#local-6989586621679076314"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076313"><span class="hs-identifier hs-var">nm1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-273"></a><span>    </span><a name="local-6989586621679076315"><a href="#local-6989586621679076315"><span class="hs-identifier">m3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621679076312"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-special">(</span><span class="hs-number">3</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-274"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679076316"><a href="#local-6989586621679076316"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076317"><a href="#local-6989586621679076317"><span class="hs-identifier">pp</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076318"><a href="#local-6989586621679076318"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#findDecomposition"><span class="hs-identifier hs-var">findDecomposition</span></a><span> </span><a href="#local-6989586621679076313"><span class="hs-identifier hs-var">nm1</span></a><span>
</span><a name="line-275"></a><span>    </span><a name="local-6989586621679076319"><a href="#local-6989586621679076319"><span class="hs-identifier">kfcts0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679076322"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621679076317"><span class="hs-identifier hs-var">pp</span></a><span>
</span><a name="line-276"></a><span>    </span><a name="local-6989586621679076320"><a href="#local-6989586621679076320"><span class="hs-identifier">kfcts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621679076321"><span class="hs-identifier hs-var">force</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679076319"><span class="hs-identifier hs-var">kfcts0</span></a><span>
</span><a name="line-277"></a><span>    </span><a name="local-6989586621679076321"><a href="#local-6989586621679076321"><span class="hs-identifier">force</span></a></a><span> </span><a name="local-6989586621679076323"><a href="#local-6989586621679076323"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679076324"><a href="#local-6989586621679076324"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679076325"><a href="#local-6989586621679076325"><span class="hs-identifier">prf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076325"><span class="hs-identifier hs-var">prf</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076324"><span class="hs-identifier hs-var">t</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679076323"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>    </span><a name="local-6989586621679076322"><a href="#local-6989586621679076322"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679076326"><a href="#local-6989586621679076326"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076327"><a href="#local-6989586621679076327"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076328"><a href="#local-6989586621679076328"><span class="hs-identifier">byTD</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076329"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-279"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-280"></a><span>        </span><a name="local-6989586621679076329"><a href="#local-6989586621679076329"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679076330"><a href="#local-6989586621679076330"><span class="hs-identifier">bs</span></a></a><span>
</span><a name="line-281"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076330"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679076314"><span class="hs-identifier hs-var">h</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#bpswMessage"><span class="hs-identifier hs-var">bpswMessage</span></a><span> </span><a href="#local-6989586621679076312"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-282"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076332"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679076315"><span class="hs-identifier hs-var">m3</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076326"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076326"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679076327"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><a href="#local-6989586621679076312"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><a href="#local-6989586621679076330"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Trivial"><span class="hs-identifier hs-var">Trivial</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679076329"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076330"><span class="hs-identifier hs-var">bs</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076334"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">1</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#bpswMessage"><span class="hs-identifier hs-var">bpswMessage</span></a><span> </span><a href="#local-6989586621679076312"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#found"><span class="hs-identifier hs-var">found</span></a><span> </span><a href="#local-6989586621679076334"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076333"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">1</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#bpswMessage"><span class="hs-identifier hs-var">bpswMessage</span></a><span> </span><a href="#local-6989586621679076312"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#fermat"><span class="hs-identifier hs-var">fermat</span></a><span> </span><a href="#local-6989586621679076330"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076328"><span class="hs-identifier hs-var">byTD</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076326"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679076327"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><a href="#local-6989586621679076330"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#smallCert"><span class="hs-identifier hs-var">smallCert</span></a><span> </span><a href="#local-6989586621679076326"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#certify"><span class="hs-identifier hs-var">certify</span></a><span> </span><a href="#local-6989586621679076326"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-287"></a><span>                            </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Composite"><span class="hs-identifier hs-var">Composite</span></a><span> </span><a name="local-6989586621679076335"><a href="#local-6989586621679076335"><span class="hs-identifier">cpr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;***Error in factorisation code: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679076326"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-288"></a><span>                                                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; was supposed to be prime but isn't.\n&quot;</span><span>
</span><a name="line-289"></a><span>                                                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;Please report this to the maintainer.\n\n&quot;</span><span>
</span><a name="line-290"></a><span>                                                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679076335"><span class="hs-identifier hs-var">cpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>                            </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#Prime"><span class="hs-identifier hs-var">Prime</span></a><span> </span><a name="local-6989586621679076336"><a href="#local-6989586621679076336"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><a href="#local-6989586621679076326"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679076327"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><a href="#local-6989586621679076330"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><a href="#local-6989586621679076336"><span class="hs-identifier hs-var">ppr</span></a><span class="hs-special">)</span><span>
</span><a name="line-292"></a><span>              </span><span class="hs-keyword">where</span><span>
</span><a name="line-293"></a><span>                </span><a name="local-6989586621679076331"><a href="#local-6989586621679076331"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076313"><span class="hs-identifier hs-var">nm1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679076326"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-294"></a><span>                </span><a name="local-6989586621679076332"><a href="#local-6989586621679076332"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">powModInteger</span><span> </span><a href="#local-6989586621679076330"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679076331"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679076312"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-295"></a><span>                </span><a name="local-6989586621679076333"><a href="#local-6989586621679076333"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">powModInteger</span><span> </span><a href="#local-6989586621679076332"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679076326"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679076312"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-296"></a><span>                </span><a name="local-6989586621679076334"><a href="#local-6989586621679076334"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">gcd</span><span> </span><a href="#local-6989586621679076312"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076332"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-comment">-- | Find a decomposition of p-1 for the pocklington certificate.</span><span>
</span><a name="line-299"></a><span class="hs-comment">--   Usually bloody slow if p-1 has two (or more) /large/ prime divisors.</span><span>
</span><a name="line-300"></a><span class="hs-identifier">findDecomposition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-301"></a><a name="findDecomposition"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#findDecomposition"><span class="hs-identifier">findDecomposition</span></a></a><span> </span><a name="local-6989586621679076337"><a href="#local-6989586621679076337"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076341"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679076337"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679076340"><span class="hs-identifier hs-var">prms</span></a><span>
</span><a name="line-302"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-303"></a><span>    </span><a name="local-6989586621679076338"><a href="#local-6989586621679076338"><span class="hs-identifier">sr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Powers.Squares.html#integerSquareRoot%27"><span class="hs-identifier hs-var">integerSquareRoot'</span></a><span> </span><a href="#local-6989586621679076337"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-304"></a><span>    </span><a name="local-6989586621679076339"><a href="#local-6989586621679076339"><span class="hs-identifier">pbd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">min</span><span> </span><span class="hs-number">1000000</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076338"><span class="hs-identifier hs-var">sr</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">20</span><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>    </span><a name="local-6989586621679076340"><a href="#local-6989586621679076340"><span class="hs-identifier">prms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Sieve.Eratosthenes.html#primeList"><span class="hs-identifier hs-var">primeList</span></a><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Sieve.Eratosthenes.html#primeSieve"><span class="hs-identifier hs-var">primeSieve</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679076339"><span class="hs-identifier hs-var">pbd</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>    </span><a name="local-6989586621679076341"><a href="#local-6989586621679076341"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679076342"><a href="#local-6989586621679076342"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679076343"><a href="#local-6989586621679076343"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679076344"><a href="#local-6989586621679076344"><span class="hs-identifier">afs</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679076345"><a href="#local-6989586621679076345"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679076346"><a href="#local-6989586621679076346"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-307"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076342"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679076343"><span class="hs-identifier hs-var">b</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076342"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679076344"><span class="hs-identifier hs-var">afs</span></a><span class="hs-special">,</span><a href="#local-6989586621679076343"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-308"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.NumberTheory.Utils.html#splitOff"><span class="hs-identifier hs-var">splitOff</span></a><span> </span><a href="#local-6989586621679076345"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679076343"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-309"></a><span>                        </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679076341"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679076342"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679076343"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679076344"><span class="hs-identifier hs-var">afs</span></a><span> </span><a href="#local-6989586621679076346"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-310"></a><span>                        </span><span class="hs-special">(</span><a name="local-6989586621679076347"><a href="#local-6989586621679076347"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076348"><a href="#local-6989586621679076348"><span class="hs-identifier">q</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679076341"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076342"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679076345"><span class="hs-identifier hs-var">p</span></a><span class="hs-operator hs-var">^</span><a href="#local-6989586621679076347"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679076348"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679076345"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679076347"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679076344"><span class="hs-identifier hs-var">afs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679076346"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-311"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679076349"><a href="#local-6989586621679076349"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679076350"><a href="#local-6989586621679076350"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679076351"><a href="#local-6989586621679076351"><span class="hs-identifier">afs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-312"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076349"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679076350"><span class="hs-identifier hs-var">b</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076349"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679076351"><span class="hs-identifier hs-var">afs</span></a><span class="hs-special">,</span><a href="#local-6989586621679076350"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-313"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Probabilistic.html#bailliePSW"><span class="hs-identifier hs-var">bailliePSW</span></a><span> </span><a href="#local-6989586621679076350"><span class="hs-identifier hs-var">b</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076350"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679076350"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><a href="#local-6989586621679076349"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Until a Baillie PSW pseudoprime is found, I'm going with this</span><span>
</span><a name="line-314"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076353"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Error in factorisation, &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679076352"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; was found as a factor of &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679076350"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; but isn't.&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679076341"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076349"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679076352"><span class="hs-identifier hs-var">p</span></a><span class="hs-operator hs-var">^</span><a href="#local-6989586621679076353"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679076354"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679076352"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679076353"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679076351"><span class="hs-identifier hs-var">afs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-316"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-317"></a><span>            </span><a name="local-6989586621679076352"><a href="#local-6989586621679076352"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#findFactor"><span class="hs-identifier hs-var">findFactor</span></a><span> </span><a href="#local-6989586621679076350"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-number">8</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-318"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679076353"><a href="#local-6989586621679076353"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076354"><a href="#local-6989586621679076354"><span class="hs-identifier">q</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Utils.html#splitOff"><span class="hs-identifier hs-var">splitOff</span></a><span> </span><a href="#local-6989586621679076352"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679076350"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-comment">-- | Find a factor of a known composite with approximately digits digits,</span><span>
</span><a name="line-321"></a><span class="hs-comment">--   starting with curve s. Actually, this may loop infinitely, but the</span><span>
</span><a name="line-322"></a><span class="hs-comment">--   loop should not be entered before the heat death of the universe.</span><span>
</span><a name="line-323"></a><span class="hs-identifier">findFactor</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-324"></a><a name="findFactor"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#findFactor"><span class="hs-identifier">findFactor</span></a></a><span> </span><a name="local-6989586621679076355"><a href="#local-6989586621679076355"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679076356"><a href="#local-6989586621679076356"><span class="hs-identifier">digits</span></a></a><span> </span><a name="local-6989586621679076357"><a href="#local-6989586621679076357"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#findLoop"><span class="hs-identifier hs-var">findLoop</span></a><span> </span><a href="#local-6989586621679076355"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679076358"><span class="hs-identifier hs-var">lo</span></a><span> </span><a href="#local-6989586621679076359"><span class="hs-identifier hs-var">hi</span></a><span> </span><a href="#local-6989586621679076360"><span class="hs-identifier hs-var">count</span></a><span> </span><a href="#local-6989586621679076357"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-325"></a><span>                          </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679076361"><a href="#local-6989586621679076361"><span class="hs-identifier">t</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#findFactor"><span class="hs-identifier hs-var">findFactor</span></a><span> </span><a href="#local-6989586621679076355"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076356"><span class="hs-identifier hs-var">digits</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">5</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679076361"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-326"></a><span>                          </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679076362"><a href="#local-6989586621679076362"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679076362"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-327"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-328"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679076358"><a href="#local-6989586621679076358"><span class="hs-identifier">lo</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076359"><a href="#local-6989586621679076359"><span class="hs-identifier">hi</span></a></a><span class="hs-special">,</span><a name="local-6989586621679076360"><a href="#local-6989586621679076360"><span class="hs-identifier">count</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Math.NumberTheory.Primes.Factorisation.Montgomery.html#findParms"><span class="hs-identifier hs-var">findParms</span></a><span> </span><a href="#local-6989586621679076356"><span class="hs-identifier hs-var">digits</span></a><span>
</span><a name="line-329"></a><span>
</span><a name="line-330"></a><span class="hs-comment">-- | Find a factor or say with which curve to continue.</span><span>
</span><a name="line-331"></a><span class="hs-identifier">findLoop</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-332"></a><a name="findLoop"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#findLoop"><span class="hs-identifier">findLoop</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>  </span><span class="hs-number">0</span><span>  </span><a name="local-6989586621679076363"><a href="#local-6989586621679076363"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679076363"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-333"></a><span class="hs-identifier">findLoop</span><span> </span><a name="local-6989586621679076364"><a href="#local-6989586621679076364"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679076365"><a href="#local-6989586621679076365"><span class="hs-identifier">lo</span></a></a><span> </span><a name="local-6989586621679076366"><a href="#local-6989586621679076366"><span class="hs-identifier">hi</span></a></a><span> </span><a name="local-6989586621679076367"><a href="#local-6989586621679076367"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-6989586621679076368"><a href="#local-6989586621679076368"><span class="hs-identifier">s</span></a></a><span>
</span><a name="line-334"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679076364"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679076368"><span class="hs-identifier hs-var">s</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">2</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-335"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679076368"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">`</span><a href="Math.NumberTheory.Moduli.Class.html#modulo"><span class="hs-identifier hs-var">modulo</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621679076364"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-336"></a><span>                    </span><a href="Math.NumberTheory.Moduli.Class.html#InfMod"><span class="hs-identifier hs-var">InfMod</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;impossible case&quot;</span><span>
</span><a name="line-337"></a><span>                    </span><a href="Math.NumberTheory.Moduli.Class.html#SomeMod"><span class="hs-identifier hs-var">SomeMod</span></a><span> </span><a name="local-6989586621679076369"><a href="#local-6989586621679076369"><span class="hs-identifier">sn</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Math.NumberTheory.Primes.Factorisation.Montgomery.html#montgomeryFactorisation"><span class="hs-identifier hs-var">montgomeryFactorisation</span></a><span> </span><a href="#local-6989586621679076365"><span class="hs-identifier hs-var">lo</span></a><span> </span><a href="#local-6989586621679076366"><span class="hs-identifier hs-var">hi</span></a><span> </span><a href="#local-6989586621679076369"><span class="hs-identifier hs-var">sn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-338"></a><span>                      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#findLoop"><span class="hs-identifier hs-var">findLoop</span></a><span> </span><a href="#local-6989586621679076364"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679076365"><span class="hs-identifier hs-var">lo</span></a><span> </span><a href="#local-6989586621679076366"><span class="hs-identifier hs-var">hi</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076367"><span class="hs-identifier hs-var">ct</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076368"><span class="hs-identifier hs-var">s</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>                      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679076370"><a href="#local-6989586621679076370"><span class="hs-identifier">fct</span></a></a><span>
</span><a name="line-340"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a href="Math.NumberTheory.Primes.Testing.Probabilistic.html#bailliePSW"><span class="hs-identifier hs-var">bailliePSW</span></a><span> </span><a href="#local-6989586621679076370"><span class="hs-identifier hs-var">fct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679076370"><span class="hs-identifier hs-var">fct</span></a><span>
</span><a name="line-341"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#findFactor"><span class="hs-identifier hs-var">findFactor</span></a><span> </span><a href="#local-6989586621679076370"><span class="hs-identifier hs-var">fct</span></a><span> </span><span class="hs-number">8</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679076368"><span class="hs-identifier hs-var">s</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span class="hs-comment">-- | Message in the unlikely case a Baillie PSW pseudoprime is found.</span><span>
</span><a name="line-344"></a><span class="hs-identifier">bpswMessage</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-345"></a><a name="bpswMessage"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#bpswMessage"><span class="hs-identifier">bpswMessage</span></a></a><span> </span><a name="local-6989586621679076371"><a href="#local-6989586621679076371"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unlines</span><span>
</span><a name="line-346"></a><span>                    </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;\n***Congratulations! You found a Baillie PSW pseudoprime!&quot;</span><span>
</span><a name="line-347"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Please report this finding to the package maintainer,&quot;</span><span>
</span><a name="line-348"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&lt;daniel.is.fischer@googlemail.com&gt;&quot;</span><span>
</span><a name="line-349"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;The number in question is:\n&quot;</span><span>
</span><a name="line-350"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679076371"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-351"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;\nOther parties like wikipedia might also be interested.&quot;</span><span>
</span><a name="line-352"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;\nSorry for aborting your programme, but this is a major discovery.&quot;</span><span>
</span><a name="line-353"></a><span>                    </span><span class="hs-special">]</span><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-comment">-- | Found a factor</span><span>
</span><a name="line-356"></a><span class="hs-identifier">found</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-357"></a><a name="found"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#found"><span class="hs-identifier">found</span></a></a><span> </span><a name="local-6989586621679076372"><a href="#local-6989586621679076372"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\nA nontrivial divisor is:\n&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679076372"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span class="hs-comment">-- | Fermat failure</span><span>
</span><a name="line-360"></a><span class="hs-identifier">fermat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-361"></a><a name="fermat"><a href="Math.NumberTheory.Primes.Testing.Certificates.Internal.html#fermat"><span class="hs-identifier">fermat</span></a></a><span> </span><a name="local-6989586621679076373"><a href="#local-6989586621679076373"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\nThe Fermat test fails for base\n&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679076373"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-362"></a></pre></body></html>